<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xmlns:pro="http://www.liquibase.org/xml/ns/pro"
        xsi:schemaLocation="
            http://www.liquibase.org/xml/ns/dbchangelog
            http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd
            http://www.liquibase.org/xml/ns/dbchangelog-ext
            http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd
            http://www.liquibase.org/xml/ns/pro
            http://www.liquibase.org/xml/ns/pro/liquibase-pro-latest.xsd">

    <changeSet id="database-setup" author="yuzdzhan.ahmed" runAlways="false">

        <createTable tableName="flight">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="flight_date" type="date" />
            <column name="departure_time" type="varchar(155)" />
            <column name="arrival_time" type="varchar(155)" />
            <column name="range" type="bigint" />
            <column name="departure_airport_id" type="bigint" />
            <column name="arrival_airport_id" type="bigint" />
            <column name="flight_status_id" type="bigint" />
            <column name="aircraft_id" type="bigint" />
            <column name="airline_id" type="bigint" />
            <column name="departure_iata_code" type="varchar(20)" />
            <column name="arrival_iata_code" type="varchar(20)" />
            <column name="airline_iata" type="varchar(20)" />
            <column name="airline_icao" type="varchar(20)" />
        </createTable>

        <createTable tableName="airport">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="airport_name" type="varchar(250)"/>
            <column name="iata_code" type="varchar(20)"/>
            <column name="city_id" type="bigint" />
        </createTable>

        <createTable tableName="city">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="city_name" type="varchar(250)" />
            <column name="timezone" type="varchar(250)" />
            <column name="iata_code" type="varchar(20)"/>
        </createTable>

        <createTable tableName="airline">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="airline_name" type="varchar(250)" />
            <column name="icao_code" type="varchar(20)" />
            <column name="iata_code" type="varchar(20)"/>
        </createTable>

        <createTable tableName="aircraft">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="aircraft_model" type="varchar(100)" />
            <column name="aircraft_reg" type="varchar(30)" />
            <column name="aita_assignment" type="varchar(30)" />
            <column name="aircraft_age" type="FLOAT(53)" />
        </createTable>

        <createTable tableName="flight_status">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="status" type="VARCHAR(100)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>

        <addForeignKeyConstraint constraintName="fk_flight2departure"
                                 baseTableName="flight"
                                 baseColumnNames="departure_airport_id"
                                 referencedTableName="airport"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint constraintName="fk_flight2arrival"
                                 baseTableName="flight"
                                 baseColumnNames="arrival_airport_id"
                                 referencedTableName="airport"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint constraintName="fk_flight2status"
                                 baseTableName="flight"
                                 baseColumnNames="flight_status_id"
                                 referencedTableName="flight_status"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint constraintName="fk_flight2aircraft"
                                 baseTableName="flight"
                                 baseColumnNames="aircraft_id"
                                 referencedTableName="aircraft"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint constraintName="fk_airport2city"
                                 baseTableName="airport"
                                 baseColumnNames="city_id"
                                 referencedTableName="city"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint constraintName="fk_flight2airline"
                                 baseTableName="flight"
                                 baseColumnNames="airline_id"
                                 referencedTableName="airline"
                                 referencedColumnNames="id"/>

    </changeSet>

    <changeSet id="add-unique-constraint-cityname-timezone-iata_code" author="yuzdzhan.ahmed">
        <addUniqueConstraint
                columnNames="city_name, timezone, iata_code"
                constraintName="uk_city_name_timezone_iata_code"
                tableName="city"/>
    </changeSet>

    <changeSet id="add-unique-constraint-airplane-name-icao_code-iata_code" author="yuzdzhan.ahmed">
        <addUniqueConstraint
                columnNames="airline_name, icao_code, iata_code"
                constraintName="uk_airline_name_icao_code"
                tableName="airline"/>
    </changeSet>

    <changeSet id="add-unique-constraint-airport-name-iata_code" author="yuzdzhan.ahmed">
        <addUniqueConstraint
                columnNames="airport_name, iata_code"
                constraintName="uk_airport_name_iata_code"
                tableName="airport"/>
    </changeSet>
</databaseChangeLog>